---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PhaseNav from '../../../components/PhaseNav.astro';
---

<BaseLayout title="Phase 4: Desensitization - EMDR" description="Processing the target memory using bilateral stimulation until the disturbance is neutralized.">
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-16">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-6 no-print">
      <ol class="flex items-center gap-2 text-charcoal/60">
        <li><a href="/clinicians" class="hover:text-forest-600 transition-colors">Clinicians</a></li>
        <li>/</li>
        <li><a href="/clinicians/emdr" class="hover:text-forest-600 transition-colors">EMDR</a></li>
        <li>/</li>
        <li class="text-charcoal">Phase 4</li>
      </ol>
    </nav>

    <!-- Header with visual emphasis -->
    <header class="mb-10">
      <div class="flex items-start justify-between flex-wrap gap-4">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 bg-gradient-to-br from-coral-500 to-coral-600 rounded-2xl flex items-center justify-center text-white font-serif text-2xl font-bold shadow-lg">
            4
          </div>
          <div>
            <p class="text-coral-600 font-medium text-sm uppercase tracking-wide">Phase 4 of 8</p>
            <h1 class="font-serif text-3xl sm:text-4xl font-semibold text-charcoal">
              Desensitization
            </h1>
          </div>
        </div>
        <button
          onclick="window.print()"
          class="no-print inline-flex items-center gap-2 px-4 py-2 bg-white border border-wood-300 text-charcoal rounded-lg hover:bg-wood-50 transition-colors text-sm shadow-sm"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
          </svg>
          Print
        </button>
      </div>
    </header>

    <!-- Goals as horizontal pills -->
    <div class="flex flex-wrap gap-2 mb-10">
      <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-coral-100 text-coral-700 rounded-full text-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Process disturbing material
      </span>
      <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-coral-100 text-coral-700 rounded-full text-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Reduce SUD to 0
      </span>
      <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-coral-100 text-coral-700 rounded-full text-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Allow adaptive integration
      </span>
      <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-coral-100 text-coral-700 rounded-full text-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Follow associative processing
      </span>
    </div>

    <!-- Two column layout for main content -->
    <div class="grid lg:grid-cols-3 gap-6">

      <!-- Left column: Main content cards -->
      <div class="lg:col-span-2 space-y-6">

        <!-- Setup Script Card -->
        <div class="bg-white rounded-xl shadow-sm border border-wood-200 overflow-hidden">
          <div class="bg-gradient-to-r from-coral-500 to-coral-600 px-5 py-3">
            <h2 class="text-white font-semibold flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Setup Script
            </h2>
          </div>
          <div class="p-5">
            <div class="bg-coral-50 rounded-lg p-4 border-l-4 border-coral-500 mb-4">
              <p class="text-sm text-charcoal italic leading-relaxed">
                "Remember that this is not happening now and you are safe. I am right here with you. Let whatever happens happen, just notice what is coming up for you. Any thoughts, images, emotions and body sensations. Remember that there is no right or wrong, just watch what is coming up and notice them as you would observe the scenery from a moving train. You can use your stop signal if needed."
              </p>
            </div>
          </div>
        </div>

        <!-- Beginning Processing Card -->
        <div class="bg-white rounded-xl shadow-sm border border-wood-200 overflow-hidden">
          <div class="bg-gradient-to-r from-forest-500 to-forest-600 px-5 py-3">
            <h2 class="text-white font-semibold flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              Beginning Processing
            </h2>
          </div>
          <div class="p-5">
            <div class="bg-forest-50 rounded-lg p-4 border-l-4 border-forest-500 mb-4">
              <p class="text-sm text-charcoal italic leading-relaxed">
                "Now I am inviting you to hold in your mind and body:<br/>
                • The image<br/>
                • The negative belief: [state NC]<br/>
                • The emotions: [state emotions]<br/>
                • That you feel in your [body location]<br/><br/>
                And I am going to [client's preferred BLS method] for you to follow."
              </p>
            </div>
            <div class="bg-teal-100 rounded-lg p-3 text-center">
              <p class="text-sm font-medium text-teal-800">Begin bilateral stimulation: 24-36 passes (~30 seconds)</p>
            </div>
          </div>
        </div>

        <!-- Between Sets Card -->
        <div class="bg-white rounded-xl shadow-sm border border-wood-200 overflow-hidden">
          <div class="bg-gradient-to-r from-teal-500 to-teal-600 px-5 py-3">
            <h2 class="text-white font-semibold flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
              </svg>
              Between Sets
            </h2>
          </div>
          <div class="p-5">
            <div class="grid sm:grid-cols-2 gap-4 mb-4">
              <div class="border-2 border-teal-200 rounded-xl p-4">
                <h3 class="font-semibold text-charcoal mb-2 text-sm">After Each Set:</h3>
                <div class="bg-teal-50 rounded-lg p-3">
                  <p class="text-sm text-charcoal italic">"Let's stop, take a breath, let it go… What are you noticing now?"</p>
                </div>
                <p class="text-xs text-charcoal/60 mt-2 text-center">or</p>
                <div class="bg-teal-50 rounded-lg p-3 mt-2">
                  <p class="text-sm text-charcoal italic">"What is happening now?"</p>
                </div>
              </div>
              <div class="border-2 border-forest-200 rounded-xl p-4">
                <h3 class="font-semibold text-charcoal mb-2 text-sm">Continue Processing:</h3>
                <div class="bg-forest-50 rounded-lg p-3">
                  <p class="text-sm text-charcoal italic">"Go with that."</p>
                </div>
                <p class="text-xs text-charcoal/60 mt-2 text-center">or</p>
                <div class="bg-forest-50 rounded-lg p-3 mt-2">
                  <p class="text-sm text-charcoal italic">"Notice that."</p>
                </div>
                <p class="text-xs text-charcoal/60 mt-2 text-center">Resume BLS (24-36 passes)</p>
              </div>
            </div>

            <div class="mt-4 pt-4 border-t border-wood-100">
              <h3 class="text-sm font-semibold text-charcoal/60 uppercase tracking-wide mb-3">Return to Target</h3>
              <div class="bg-wood-50 rounded-lg p-4">
                <p class="text-sm text-charcoal italic mb-2">"When you go back to the original incident, what do you get now?"</p>
                <p class="text-sm text-charcoal italic">"On a scale of 0-10, how disturbing does it feel now?"</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Processing Guidelines Card -->
        <div class="bg-white rounded-xl shadow-sm border border-wood-200 overflow-hidden">
          <div class="bg-gradient-to-r from-lavender-500 to-lavender-600 px-5 py-3">
            <h2 class="text-white font-semibold flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
              </svg>
              Processing Guidelines
            </h2>
          </div>
          <div class="p-5">
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <h3 class="text-sm font-semibold text-charcoal mb-3">Stay Out of the Way</h3>
                <p class="text-sm text-charcoal/70 mb-3">Processing continues spontaneously unless:</p>
                <ul class="space-y-2 text-sm text-charcoal/80">
                  <li class="flex items-start gap-2">
                    <span class="text-coral-500 mt-1">•</span>
                    Information processing stalls
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-coral-500 mt-1">•</span>
                    Two consecutive negative responses
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-coral-500 mt-1">•</span>
                    Client shifts into hypo/hyper arousal
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-coral-500 mt-1">•</span>
                    Client uses stop signal
                  </li>
                </ul>
              </div>
              <div>
                <h3 class="text-sm font-semibold text-charcoal mb-3">What Clients May Experience</h3>
                <ul class="space-y-2 text-sm text-charcoal/80">
                  <li class="flex items-start gap-2">
                    <span class="text-forest-500 mt-1">•</span>
                    New images or memories
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-forest-500 mt-1">•</span>
                    Different emotions (sometimes intense)
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-forest-500 mt-1">•</span>
                    Body sensations shifting
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-forest-500 mt-1">•</span>
                    Insights or new thoughts
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-forest-500 mt-1">•</span>
                    Nothing noticeable (this is okay)
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Cognitive Interweaves Card -->
        <div class="bg-white rounded-xl shadow-sm border border-wood-200 overflow-hidden">
          <div class="bg-gradient-to-r from-sunny-500 to-sunny-600 px-5 py-3">
            <h2 class="text-white font-semibold flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              Cognitive Interweaves
            </h2>
          </div>
          <div class="p-5">
            <p class="text-sm text-charcoal/70 mb-4">Use <strong>only</strong> when processing is stuck:</p>
            <div class="space-y-3">
              <div class="flex items-center gap-4 p-3 rounded-lg bg-gradient-to-r from-sunny-50 to-transparent">
                <div class="w-24 flex-shrink-0">
                  <span class="inline-block px-2 py-1 bg-sunny-500 text-white text-xs font-bold rounded">RESPONSIBILITY</span>
                </div>
                <p class="text-sm text-charcoal italic">"Whose fault was it really?"</p>
              </div>
              <div class="flex items-center gap-4 p-3 rounded-lg bg-gradient-to-r from-teal-50 to-transparent">
                <div class="w-24 flex-shrink-0">
                  <span class="inline-block px-2 py-1 bg-teal-500 text-white text-xs font-bold rounded">SAFETY</span>
                </div>
                <p class="text-sm text-charcoal italic">"Is it over? Are you safe now?"</p>
              </div>
              <div class="flex items-center gap-4 p-3 rounded-lg bg-gradient-to-r from-lavender-50 to-transparent">
                <div class="w-24 flex-shrink-0">
                  <span class="inline-block px-2 py-1 bg-lavender-500 text-white text-xs font-bold rounded">CHOICES</span>
                </div>
                <p class="text-sm text-charcoal italic">"What choices did you have as a child?"</p>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Right column: Sticky Sidebar -->
      <div class="lg:col-span-1">
        <div class="lg:sticky lg:top-24 space-y-6">
          <!-- Quick Checklist -->
          <div class="bg-white rounded-xl shadow-sm border border-wood-200 overflow-hidden">
          <div class="bg-coral-900 px-4 py-3">
            <h2 class="text-white font-semibold text-sm flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
              </svg>
              Quick Checklist
            </h2>
          </div>
          <div class="p-4">
            <ol class="space-y-2 text-sm">
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">1</span>
                <span>Remind client of safety & stop signal</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">2</span>
                <span>Activate target (image + NC + emotions + body)</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">3</span>
                <span>Begin BLS (24-36 passes)</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">4</span>
                <span>"What do you notice?" after each set</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">5</span>
                <span>"Go with that" — continue</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">6</span>
                <span>Return to target when needed</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">7</span>
                <span>Check SUD when client reports calm</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="w-5 h-5 rounded-full bg-coral-100 text-coral-700 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">8</span>
                <span>Continue until SUD = 0 or ecological</span>
              </li>
            </ol>
          </div>
        </div>

        <!-- Move to Phase 5 -->
        <div class="bg-gradient-to-br from-forest-50 to-teal-50 rounded-xl border border-forest-200 overflow-hidden">
          <div class="px-4 py-3 border-b border-forest-200">
            <h2 class="font-semibold text-forest-800 text-sm flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
              When to Move to Phase 5
            </h2>
          </div>
          <div class="p-4">
            <p class="text-sm text-forest-800">Continue Phase 4 until:</p>
            <ul class="mt-2 space-y-1 text-sm text-forest-700">
              <li class="flex items-center gap-2">
                <span class="text-forest-500">✓</span>
                SUD = 0, or
              </li>
              <li class="flex items-center gap-2">
                <span class="text-forest-500">✓</span>
                SUD is ecological (as low as realistic)
              </li>
            </ul>
          </div>
        </div>

        <!-- Clinical Considerations -->
        <div class="bg-gradient-to-br from-amber-50 to-amber-100/50 rounded-xl border border-amber-200 overflow-hidden">
          <div class="px-4 py-3 border-b border-amber-200">
            <h2 class="font-semibold text-amber-800 text-sm flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
              Clinical Notes
            </h2>
          </div>
          <ul class="p-4 space-y-2 text-sm text-amber-900/80">
            <li class="flex items-start gap-2">
              <span class="text-amber-500 mt-1">•</span>
              <strong>Trust the process</strong> — avoid leading
            </li>
            <li class="flex items-start gap-2">
              <span class="text-amber-500 mt-1">•</span>
              Incomplete sessions need Phase 7 closure
            </li>
            <li class="flex items-start gap-2">
              <span class="text-amber-500 mt-1">•</span>
              High abreaction not always necessary
            </li>
            <li class="flex items-start gap-2">
              <span class="text-amber-500 mt-1">•</span>
              Watch for looping or blocking patterns
            </li>
            <li class="flex items-start gap-2">
              <span class="text-amber-500 mt-1">•</span>
              Use interweaves sparingly
            </li>
            <li class="flex items-start gap-2">
              <span class="text-amber-500 mt-1">•</span>
              Document channel changes during processing
            </li>
          </ul>
        </div>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="phase-nav mt-10">
      <PhaseNav currentPhase={4} />
    </div>
  </div>
</BaseLayout>
